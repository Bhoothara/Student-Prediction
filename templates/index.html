<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <meta name="theme-color" content="#007cf0">

  <!-- keep these as in your project -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chip_select') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='career_form.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/predict_popup.css') }}">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Career Form â€” Student Career Predictor</title>

  <style>
    /* Inline helper styles for the reusable custom-entry control */
    #multiCustomRow {
      display: none; /* shown only when an 'Other' option is selected */
      margin-top: 10px;
      width: 100%;
      box-sizing: border-box;
    }
    #multiCustomRow .multi-input {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1.5px solid #d1d9e6;
      font-size: 15px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    #multiCustomRow .multi-actions {
      display:flex;
      gap:12px;
      width:100%;
    }
    #multiCustomRow .multi-actions .multi-add {
      flex:2;
      padding:12px;
      border-radius:10px;
      border:none;
      background:linear-gradient(90deg,#007cf0,#00dfd8);
      color:white;
      font-weight:700;
      font-size:15px;
      cursor:pointer;
    }
    #multiCustomRow .multi-actions .multi-cancel {
      flex:1;
      padding:12px;
      border-radius:10px;
      border:1.5px solid #d1d9e6;
      background:#fff;
      font-size:15px;
      font-weight:600;
      cursor:pointer;
    }
    #multiHint { display:none; font-size:14px; color:#666; margin-top:6px; }
  </style>
</head>
<body>
  <!-- Top nav -->
  <nav style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(to right, #007cf0, #00dfd8);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 30px;
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    box-sizing: border-box;
  ">
    <div style="display: flex; align-items: center; gap: 10px;">
      <span style="font-size: 1.6rem;">ðŸŽ“</span>
      <h2 style="margin: 0; font-weight: 700; font-size: 1.4rem;">Welcome to Student Career Predictor</h2>
    </div>

    {% if user %}
      <div style="display: flex; align-items: center; gap: 15px; flex-shrink: 0;">
        <span style="font-size: 0.95rem;">Welcome, <b>{{ user.username }}</b></span>
        <a href="{{ url_for('logout') }}"
           style="background-color: white; color: #007cf0; padding: 8px 16px; border-radius: 20px; text-decoration: none; font-weight: 600; font-size: 0.95rem; transition: 0.3s; white-space: nowrap;"
           onmouseover="this.style.backgroundColor='#e3f2ff'"
           onmouseout="this.style.backgroundColor='white'">
          Logout
        </a>
      </div>
    {% endif %}
  </nav>

  <div style="margin-top: 80px;"></div>

  <script src="{{ url_for('static', filename='js/predict_popup.js') }}"></script>

  <div class="page">
    <form id="careerForm" class="card" autocomplete="off">
      <h2>ðŸŽ“ Career Prediction Form</h2>

      <label>Acedamic % in Operating Systems*</label>
      <input type="number" id="os" min="0" max="100" required>

      <label>Percentage in Algorithms*</label>
      <input type="number" id="algo" min="0" max="100" required>

      <label>Programming Concepts (%)*</label>
      <input type="number" id="prog" min="0" max="100" required>

      <label>Software Engineering (%)*</label>
      <input type="number" id="se" min="0" max="100" required>

      <label>Computer Networks (%)*</label>
      <input type="number" id="net" min="0" max="100" required>

      <label>Electronics Subjects (%)*</label>
      <input type="number" id="elec" min="0" max="100" required>

      <label>Computer Architecture (%)*</label>
      <input type="number" id="arch" min="0" max="100" required>

      <label>Mathematics (%)*</label>
      <input type="number" id="math" min="0" max="100" required>

      <label>Communication Skills (%)*</label>
      <input type="number" id="comm" min="0" max="100" required>

      <label>Logical Quotient Rating (1â€“10)</label>
      <div class="ranges">
        <input type="range" id="logic" min="1" max="10" value="5" oninput="logicOutput.value=this.value">
        <output id="logicOutput">5</output>
      </div>

      <label>Hackathons Attended*</label>
      <input type="number" id="hack" min="0" max="99" required>

      <label>Coding Skills Rating (1â€“10)</label>
      <div class="ranges">
        <input type="range" id="code" min="1" max="10" value="5" oninput="codeOutput.value=this.value">
        <output id="codeOutput">5</output>
      </div>

      <label>Public Speaking Points (1â€“10)</label>
      <div class="ranges">
        <input type="range" id="speak" min="1" max="10" value="5" oninput="speakOutput.value=this.value">
        <output id="speakOutput">5</output>
      </div>

      <label>Self-Learning Capability?</label>
      <select id="self">
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>

      <label>Extra Courses Done?</label>
      <select id="extra">
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>

      <!-- Certifications (with Other option) -->
      <label>Certifications</label>
      <select id="cert" multiple class="chip-enabled">
        <option value="">-- Select Certification --</option>
        <option value="1">Python Programming</option>
        <option value="2">Java Full Stack</option>
        <option value="3">Data Science</option>
        <option value="4">Machine Learning</option>
        <option value="5">Cloud Computing (AWS / Azure)</option>
        <option value="6">Cyber Security</option>
        <option value="7">Web Development</option>
        <option value="8">Database Management (SQL)</option>
        <option value="9">Artificial Intelligence</option>
        <option value="other">Other (enter certificate)</option>
      </select>

      <!-- Workshops -->
      <label>Workshops</label>
      <select id="work" multiple class="chip-enabled">
        <option value="">-- Select Workshop --</option>
        <option value="1">Python Programming Workshop</option>
        <option value="2">AI & Machine Learning Bootcamp</option>
        <option value="3">Web Development Workshop</option>
        <option value="4">Data Analytics with Excel</option>
        <option value="5">Cyber Security Awareness Workshop</option>
        <option value="6">Cloud Computing (AWS / Azure)</option>
        <option value="7">Database & SQL Workshop</option>
        <option value="8">Mobile App Development Workshop</option>
        <option value="9">IoT (Internet of Things)</option>
        <option value="other">Other (enter workshop)</option>
      </select>

      <!-- Reading / Writing -->
      <label>Reading/Writing Skills</label>
      <select id="read" multiple class="chip-enabled">
        <option value="">-- Select Reading/Writing Level --</option>
        <option value="1">Excellent â€” Strong reading & writing communication</option>
        <option value="2">Good â€” Can write and understand technical content</option>
        <option value="3">Average â€” Understands basics but needs improvement</option>
        <option value="4">Below Average â€” Struggles with comprehension</option>
        <option value="5">Poor â€” Needs major improvement</option>
      </select>

      <!-- Interested Career Area -->
      <label>Interested Career Area</label>
      <select id="career" multiple class="chip-enabled">
        <option value="">-- Select Your Career Interest --</option>
        <option value="1">Software Development</option>
        <option value="2">Web Development</option>
        <option value="3">Data Science / Machine Learning</option>
        <option value="4">Artificial Intelligence</option>
        <option value="5">Cybersecurity</option>
        <option value="6">Cloud Computing</option>
        <option value="7">Networking & Infrastructure</option>
        <option value="8">Database Administration</option>
        <option value="9">UI/UX Design</option>
        <option value="10">Research & Teaching</option>
        <option value="other">Other (enter career area)</option>
      </select>

      <!-- Preferred Company Type -->
      <label>Preferred Company Type</label>
      <select id="company" multiple class="chip-enabled">
        <option value="">-- Select Preferred Company Type --</option>
        <option value="1">Startup</option>
        <option value="2">Product-Based Company</option>
        <option value="3">Service-Based Company</option>
        <option value="4">Government Organization</option>
        <option value="5">Research Institute</option>
        <option value="6">Non-Profit / NGO</option>
        <option value="7">Freelance / Self-Employed</option>
        <option value="8">Abroad / MNC Company</option>
        <option value="other">Other (enter company type)</option>
      </select>

      <!-- Reusable custom-entry row (single) -->
      <div id="multiCustomRow" aria-hidden="true">
        <input id="multiCustomInput" class="multi-input" type="text" placeholder="Enter custom value...">
        <div class="multi-actions">
          <button type="button" id="multiAddBtn" class="multi-add">Add</button>
          <button type="button" id="multiCancelBtn" class="multi-cancel">Cancel</button>
        </div>
      </div>
      <div id="multiHint">Tip: type the value then press Add (or press Enter).</div>

      <label>Worked in Teams Before?</label>
      <select id="team">
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>

      <button id="predictBtn" type="submit">Predict Career</button>
      <div id="result"></div>
    </form>
  </div>

  <!-- Eligibility modal -->
  <div id="eligModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-labelledby="eligTitle">
      <h3 id="eligTitle">Not eligible</h3>
      <p id="eligMsg"></p>
      <button id="eligClose">OK</button>
    </div>
  </div>

  <script>
    /* ----- form validation & submit (kept from your original) ----- */
    const requiredPercentIds = ['os','algo','prog','se','net','elec','arch','math','comm'];
    const predictBtn = document.getElementById('predictBtn');
    const eligibilityModal = document.getElementById('eligModal');
    const eligClose = document.getElementById('eligClose');
    const eligMsg = document.getElementById('eligMsg');
    const careerForm = document.getElementById('careerForm');

    function rawVal(id) { return document.getElementById(id).value.trim(); }
    function numVal(id) { const v = rawVal(id); return v === "" ? NaN : Number(v); }

    function showIneligibleModal(badFields) {
      const parts = badFields.map(f => {
        const v = rawVal(f) || "empty";
        const labelMap = { os:"OS", algo:"Algorithms", prog:"Programming Concepts", se:"Software Engineering", net:"Computer Networks", elec:"Electronics", arch:"Computer Architecture", math:"Mathematics", comm:"Communication Skills" };
        return ${labelMap[f] || f}: ${v}%;
      });
        eligMsg.textContent = The following field(s) are below the minimum required (35%): ${parts.join(', ')}. Please correct them to continue.;
      eligibilityModal.style.display = 'flex';
      eligibilityModal.setAttribute('aria-hidden','false');
    }

    function closeEligibilityModal() { eligibilityModal.style.display = 'none'; eligibilityModal.setAttribute('aria-hidden','true'); }

    eligClose.addEventListener('click', closeEligibilityModal);
    eligibilityModal.addEventListener('click', (ev) => { if (ev.target === eligibilityModal) closeEligibilityModal(); });

    requiredPercentIds.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('blur', () => {
        const raw = rawVal(id);
        if (raw === "") return;
        const nv = Number(raw);
        if (!isFinite(nv)) return;
        if (nv < 35) {
          showIneligibleModal([id]);
        }
      });
    });

    /*
    careerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const bad = [];
      for (let i = 0; i < requiredPercentIds.length; i++) {
        const id = requiredPercentIds[i];
        const raw = rawVal(id);
        if (raw === "") { bad.push(id); continue; }
        const nv = Number(raw);
        if (!isFinite(nv) || nv < 35) { bad.push(id); }
      }

      // Block if any field > 100
      const tooHigh = hasOverLimit();
      if (tooHigh.length > 0) {
        eligMsg.textContent = "Some values are above 100%. Please correct them.";
        eligibilityModal.style.display = "flex";
        eligibilityModal.setAttribute("aria-hidden", "false");
        return; // stop form
      }

      if (bad.length > 0) { showIneligibleModal(bad); return; }

      predictBtn.disabled = true;
      const payload = {
        "Acedamic percentage in Operating Systems": numVal('os') || 0,
        "percentage in Algorithms": numVal('algo') || 0,
        "Percentage in Programming Concepts": numVal('prog') || 0,
        "Percentage in Software Engineering": numVal('se') || 0,
        "Percentage in Computer Networks": numVal('net') || 0,
        "Percentage in Electronics Subjects": numVal('elec') || 0,
        "Percentage in Computer Architecture": numVal('arch') || 0,
        "Percentage in Mathematics": numVal('math') || 0,
        "Percentage in Communication skills": numVal('comm') || 0,
        "Logical quotient rating": Number(document.getElementById('logic').value || 0),
        "hackathons": Number(document.getElementById('hack').value || 0),
        "coding skills rating": Number(document.getElementById('code').value || 0),
        "public speaking points": Number(document.getElementById('speak').value || 0),
        "self-learning capability?": Number(document.getElementById('self').value || 0),
        "Extra-courses did": Number(document.getElementById('extra').value || 0),
        "certifications": Number(document.getElementById('cert').value || 0),
        "workshops": Number(document.getElementById('work').value || 0),
        "reading and writing skills": Number(document.getElementById('read').value || 0),
        "interested career area": Number(document.getElementById('career').value || 0),
        "Type of company want to settle in?": Number(document.getElementById('company').value || 0),
        "worked in teams ever?": Number(document.getElementById('team').value || 0)
      };

      const resultEl = document.getElementById('result');
      resultEl.textContent = "Predicting...";

      try {
        const res = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const json = await res.json();
        if (json && json.predicted_job_role) {
          resultEl.innerHTML = ðŸŽ¯ Predicted Career Role: <b>${json.predicted_job_role}</b>;
        } else {

    document.getElementById('logicOutput').value = document.getElementById('logic').value;
    document.getElementById('codeOutput').value = document.getElementById('code').value;
    document.getElementById('speakOutput').value = document.getElementById('speak').value;

    /* LIMIT CHECKS */
    const percentFields = ['os','algo','prog','se','net','elec','arch','math','comm'];
    function checkMaxLimit(id) {
      const el = document.getElementById(id);
      el.addEventListener("input", () => {
        let val = Number(el.value);
        if (val > 100) {
          el.value = 100;
          eligMsg.textContent = Value must be below 100%. You entered ${val}.;
          eligibilityModal.style.display = "flex";
          eligibilityModal.setAttribute("aria-hidden", "false");
        }
      });
    }
    percentFields.forEach(id => checkMaxLimit(id));
    function hasOverLimit() {
      let bad = [];
      percentFields.forEach(id => {
        const v = Number(document.getElementById(id).value || 0);
        if (v > 100) bad.push(id);
      });
      return bad;
    }
  </script>
  <script>
/* Hackathon limit: must be below 9 (i.e. 0..9 allowed).
   Place this after your percentFields / hasOverLimit logic. */
(function enforceHackLimit() {
  const hackEl = document.getElementById('hack');
  if (!hackEl) return;

  // Show modal helper (re-uses your eligMsg and eligibilityModal)
  function showHackModal() {
    eligMsg.textContent = "Please enter a value below 9 (not above 9).";
    eligibilityModal.style.display = "flex";
    eligibilityModal.setAttribute("aria-hidden", "false");
  }

  // On input: if user types >9, clamp and show message
  hackEl.addEventListener('input', () => {
    const v = Number(hackEl.value || 0);
    if (!isFinite(v)) return;
    if (v > 9) {
      // optional: clamp so the field stays valid
      hackEl.value = 9;
      showHackModal();
    } else if (v < 0) {
      // prevent negative numbers
      hackEl.value = 0;
    }
  });

  // On blur: final check
  hackEl.addEventListener('blur', () => {
    const v = Number(hackEl.value || 0);
    if (!isFinite(v)) return;
    if (v > 9) showHackModal();
  });

  // Also block submit (extra safety)
  careerForm.addEventListener('submit', (e) => {
    const v = Number(hackEl.value || 0);
    if (v > 9) {
      e.preventDefault();
      showHackModal();
      // keep predict button enabled/disabled state as appropriate
      predictBtn.disabled = false;
      return false;
    }
  });
})();
</script>


  <!-- Reusable multi-select "Other -> Add" handler -->
<script>
(function setupMultiCustom() {
  const selects = ['cert','work','career','company'];
  const multiRow = document.getElementById('multiCustomRow');
  const input = document.getElementById('multiCustomInput');
  const addBtn = document.getElementById('multiAddBtn');
  const cancelBtn = document.getElementById('multiCancelBtn');
  const hint = document.getElementById('multiHint');

  let activeSelectId = null;
  let originalParent = multiRow.parentNode; // keep reference to original place

  // Helper to insert node after a reference node
  function insertAfter(newNode, referenceNode) {
    referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
  }

  function showRowFor(selectEl) {
    activeSelectId = selectEl.id;

    // move multiRow & hint right after the active select so they appear under it
    insertAfter(multiRow, selectEl);
    insertAfter(hint, multiRow);

    multiRow.style.display = 'block';
    multiRow.setAttribute('aria-hidden','false');
    hint.style.display = 'block';
    input.value = '';
    input.focus();
  }

  function hideRow() {
    // move back to original place (optional). We'll hide instead of permanently moving.
    // If you prefer the row remain where last used, remove the next line.
    if (originalParent && originalParent !== multiRow.parentNode) {
      originalParent.appendChild(multiRow);
      originalParent.appendChild(hint);
    }

    activeSelectId = null;
    multiRow.style.display = 'none';
    multiRow.setAttribute('aria-hidden','true');
    hint.style.display = 'none';
    input.value = '';
  }

  function onSelectChange(e) {
    const sel = e.target;
    const hasOther = Array.from(sel.selectedOptions).some(o => o.value === 'other');
    if (hasOther) {
      showRowFor(sel);
    } else {
      if (activeSelectId === sel.id) hideRow();
    }
  }

  function scrollOptionIntoView(sel, optIndex) {
    try {
      const option = sel.options[optIndex];
      if (!option) return;
      const top = option.offsetTop;
      sel.scrollTop = Math.max(0, top - (sel.clientHeight / 3));
    } catch (err) { /* ignore */ }
  }

  function addCustom() {
    const text = (input.value || '').trim();
    if (!text || !activeSelectId) return;
    const sel = document.getElementById(activeSelectId);

    // dedupe by visible text (case-insensitive)
    const existing = Array.from(sel.options).find(o => o.textContent.trim().toLowerCase() === text.toLowerCase());
    let newIndex = -1;

    if (existing) {
      existing.selected = true;
      newIndex = Array.prototype.indexOf.call(sel.options, existing);
    } else {
      const val = 'custom-' + Date.now();
      const opt = document.createElement('option');
      opt.value = val;
      opt.textContent = text;
      opt.selected = true;

      // Insert BEFORE option at index 1 (so it becomes index 1)
      if (sel.options.length > 1) {
        sel.insertBefore(opt, sel.options[1]);
        newIndex = 1;
      } else {
        sel.add(opt);
        newIndex = sel.options.length - 1;
      }
    }

    // deselect 'other'
    Array.from(sel.options).forEach(o => { if (o.value === 'other') o.selected = false; });

    // ensure newly inserted option is selected and visible
    if (newIndex >= 0) {
      try { sel.selectedIndex = newIndex; } catch (e) {}
      scrollOptionIntoView(sel, newIndex);
    }

    // notify change so chip_select.js updates chips
    sel.dispatchEvent(new Event('change', { bubbles: true }));

    hideRow();
  }

  function cancelCustom() {
    if (!activeSelectId) { hideRow(); return; }
    const sel = document.getElementById(activeSelectId);
    Array.from(sel.options).forEach(o => { if (o.value === 'other') o.selected = false; });
    sel.dispatchEvent(new Event('change', { bubbles: true }));
    hideRow();
  }

  // attach listeners to each target select
  selects.forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.addEventListener('change', onSelectChange);
  });

  addBtn.addEventListener('click', addCustom);
  cancelBtn.addEventListener('click', cancelCustom);

  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') { e.preventDefault(); addCustom(); }
    else if (e.key === 'Escape') { e.preventDefault(); cancelCustom(); }
  });

  // init: if any select already has 'other' selected, show the row for first found
  for (const id of selects) {
    const el = document.getElementById(id);
    if (!el) continue;
    if (Array.from(el.selectedOptions).some(o => o.value === 'other')) {
      showRowFor(el);
      break;
    }
  }
})();
</script>


  <!-- existing chip_select.js must come after the DOM scripts -->
  <script src="{{ url_for('static', filename='js/chip_select.js') }}"></script>

  <!-- popup helper -->
  <script src="{{ url_for('static', filename='js/predict_popup.js') }}"></script>
</body>
</html>



