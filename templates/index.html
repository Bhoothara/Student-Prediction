<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <meta name="theme-color" content="#007cf0">
  <title>Career Form â€” Student Career Predictor (Clean)</title>

  <!-- Project CSS (keep your project files) -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/chip_select.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='career_form.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/predict_popup.css') }}">

  <style>
    /* minimal helper styles used by inline script */
    body { font-family: system-ui, -apple-system,Segoe UI, Roboto, "Helvetica Neue", Arial; background:#f6f8fb; color:#111; }
    .page { max-width:900px; margin:24px auto; padding:20px; }
    .card { background:#fff; border-radius:12px; padding:20px; box-shadow:0 6px 18px rgba(16,24,40,0.06); }
    label { display:block; margin-top:12px; font-weight:600; }
    input[type=number], select, .multi-input { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #d1d9e6; box-sizing:border-box; }
    .ranges { display:flex; gap:12px; align-items:center; }
    .modal-backdrop { display:none; position:fixed; inset:0; align-items:center; justify-content:center; background:rgba(0,0,0,0.35); z-index:2000; }
    .modal { background:#fff; padding:18px; border-radius:10px; max-width:520px; width:90%; box-shadow:0 10px 30px rgba(2,6,23,0.2); }
    #result { margin-top:14px; font-weight:700; }
    .chip-enabled { min-height:46px; }
    #multiCustomRow { display:none; margin-top:10px; }
    .multi-actions { display:flex; gap:10px; }
  </style>
</head>
<body>
  <nav style="position:fixed; top:0; left:0; right:0; background:linear-gradient(90deg,#007cf0,#00dfd8); color:#fff; padding:12px 26px; display:flex; justify-content:space-between; align-items:center; z-index:1000;">
    <div style="display:flex; gap:10px; align-items:center"><span style="font-size:1.4rem">ðŸŽ“</span><strong>Student Career Predictor</strong></div>
    {% if user %}
      <div style="display:flex; gap:12px; align-items:center"><span>Welcome, <b>{{ user.username }}</b></span><a href="{{ url_for('logout') }}" style="background:#fff;color:#007cf0;padding:8px 12px;border-radius:18px;text-decoration:none">Logout</a></div>
    {% endif %}
  </nav>

  <div style="height:76px"></div>

<div class="page">
    <form id="careerForm" class="card" autocomplete="off" novalidate>
      <h2>ðŸŽ¯ Career Prediction Form</h2>


      <!-- Required percentage fields (names match server payload keys) -->
<label for="os">Academic % in Operating Systems*
    <img src="{{ url_for('static', filename='icons/os.png') }}" class="subject-icon">
</label>
      <input id="os" name="Acedamic percentage in Operating Systems" type="number" min="0" max="100" required>

<label for="algo">Algorithms (%)
    <img src="{{ url_for('static', filename='icons/algorithms.png') }}" class="subject-icon">
</label>
      <input id="algo" name="percentage in Algorithms" type="number" min="0" max="100" required>

<label for="prog">Programming Concepts (%)
    <img src="{{ url_for('static', filename='icons/coding.jpg') }}" class="subject-icon">
</label>
      <input id="prog" name="Percentage in Programming Concepts" type="number" min="0" max="100" required>

<label for="se">Software Engineering (%)
    <img src="{{ url_for('static', filename='icons/software.png') }}" class="subject-icon">
</label>
      <input id="se" name="Percentage in Software Engineering" type="number" min="0" max="100" required>

<label for="net">Computer Networks (%)
    <img src="{{ url_for('static', filename='icons/Computer.png') }}" class="subject-icon">
</label>
      <input id="net" name="Percentage in Computer Networks" type="number" min="0" max="100" required>

<label for="elec">Electronics Subjects (%)
    <img src="{{ url_for('static', filename='icons/electrons.png') }}" class="subject-icon">
</label>
      <input id="elec" name="Percentage in Electronics Subjects" type="number" min="0" max="100" required>

<label for="arch">Computer Architecture (%)
    <img src="{{ url_for('static', filename='icons/com.png') }}" class="subject-icon">
</label>
      <input id="arch" name="Percentage in Computer Architecture" type="number" min="0" max="100" required>

<label for="math">Mathematics (%)
    <img src="{{ url_for('static', filename='icons/maths.png') }}" class="subject-icon">
</label>
      <input id="math" name="Percentage in Mathematics" type="number" min="0" max="100" required>

<label for="comm">Communication Skills (%)
    <img src="{{ url_for('static', filename='icons/comunication.png') }}" class="subject-icon">
</label>
      <input id="comm" name="Percentage in Communication skills" type="number" min="0" max="100" required>

      <label>Logical Quotient Rating (1â€“10)</label>
      <div class="ranges">
        <input type="range" id="logic" name="Logical quotient rating" min="1" max="10" value="5" oninput="logicOutput.value=this.value">
        <output id="logicOutput">5</output>
      </div>

      <label for="hack">Hackathons Attended*</label>
      <input id="hack" name="hackathons" type="number" min="0" max="9" required>

      <label>Programming Skills Rating (1â€“10)</label>
      <div class="ranges">
        <input type="range" id="code" name="coding skills rating" min="1" max="10" value="5" oninput="codeOutput.value=this.value">
        <output id="codeOutput">5</output>
      </div>

      <label>Public Speaking (1â€“10)</label>
      <div class="ranges">
        <input type="range" id="speak" name="public speaking points" min="1" max="10" value="5" oninput="speakOutput.value=this.value">
        <output id="speakOutput">5</output>
      </div>

      <label>Self-Learning Capability?</label>
      <select id="self" name="self-learning capability?">
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>

      <label>Extra Courses Done?</label>
      <select id="extra" name="Extra-courses did">
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>

      <!-- multi-selects with "other" option -->
   <!-- Certifications (with Other option) -->
      <label>Certifications</label>
      <select id="cert" multiple class="chip-enabled">
        <option value="">-- Select Certification --</option>
        <option value="1">Python Programming</option>
        <option value="2">Java Full Stack</option>
        <option value="3">Data Science</option>
        <option value="4">Machine Learning</option>
        <option value="5">Cloud Computing (AWS / Azure)</option>
        <option value="6">Cyber Security</option>
        <option value="7">Web Development</option>
        <option value="8">Database Management (SQL)</option>
        <option value="9">Artificial Intelligence</option>
        <option value="other">Other (enter certificate)</option>
      </select>



      <!-- Workshops -->
      <label>Workshops</label>
      <select id="work" multiple class="chip-enabled">
        <option value="">-- Select Workshop --</option>
        <option value="1">Python Programming Workshop</option>
        <option value="2">AI & Machine Learning Bootcamp</option>
        <option value="3">Web Development Workshop</option>
        <option value="4">Data Analytics with Excel</option>
        <option value="5">Cyber Security Awareness Workshop</option>
        <option value="6">Cloud Computing (AWS / Azure)</option>
        <option value="7">Database & SQL Workshop</option>
        <option value="8">Mobile App Development Workshop</option>
        <option value="9">IoT (Internet of Things)</option>
        <option value="other">Other (enter workshop)</option>
      </select>

      <!-- Reading / Writing -->
      <!-- Reading / Writing -->
      <label>Reading/Writing Skills</label>
      <select id="read" multiple class="chip-enabled">
        <option value="">-- Select Reading/Writing Level --</option>
        <option value="1">Excellent â€” Strong reading & writing communication</option>
        <option value="2">Good â€” Can write and understand technical content</option>
        <option value="3">Average â€” Understands basics but needs improvement</option>
        <option value="4">Below Average â€” Struggles with comprehension</option>
        <option value="5">Poor â€” Needs major improvement</option>
      </select>

      <!-- Interested Career Area -->
      <label>Interested Career Area</label>
      <select id="career" multiple class="chip-enabled">
        <option value="">-- Select Your Career Interest --</option>
        <option value="1">Software Development</option>
        <option value="2">Web Development</option>
        <option value="3">Data Science / Machine Learning</option>
        <option value="4">Artificial Intelligence</option>
        <option value="5">Cybersecurity</option>
        <option value="6">Cloud Computing</option>
        <option value="7">Networking & Infrastructure</option>
        <option value="8">Database Administration</option>
        <option value="9">UI/UX Design</option>
        <option value="10">Research & Teaching</option>
        <option value="other">Other (enter career area)</option>
      </select>



     <!-- Preferred Company Type -->
      <label>Preferred Company Type</label>
      <select id="company" multiple class="chip-enabled">
        <option value="">-- Select Preferred Company Type --</option>
        <option value="1">Startup</option>
        <option value="2">Product-Based Company</option>
        <option value="3">Service-Based Company</option>
        <option value="4">Government Organization</option>
        <option value="5">Research Institute</option>
        <option value="6">Non-Profit / NGO</option>
        <option value="7">Freelance / Self-Employed</option>
        <option value="8">Abroad / MNC Company</option>
        <option value="other">Other (enter company type)</option>
      </select>


      <div id="multiCustomRow" aria-hidden="true">
        <input id="multiCustomInput" class="multi-input" type="text" placeholder="Enter custom value...">
        <div class="multi-actions">
          <button type="button" id="multiAddBtn" class="multi-add">Add</button>
          <button type="button" id="multiCancelBtn" class="multi-cancel">Cancel</button>
        </div>
        <div id="multiHint">Tip: type value then press Add (or Enter)</div>
      </div>

      <label>Worked in Teams Before?</label>
      <select id="team" name="worked in teams ever?">
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>

      <div style="display:flex; gap:12px; margin-top:16px;">
        <button id="predictBtn" type="submit" style="flex:1; padding:12px 16px; border-radius:10px; border:none; background:linear-gradient(90deg,#007cf0,#00dfd8); color:#fff; font-weight:700">Predict Career</button>
        <button id="resetBtn" type="reset" style="flex:0 0 120px; padding:12px; border-radius:10px; border:1px solid #d1d9e6; background:#fff">Reset</button>
      </div>

      <div id="result" role="status" aria-live="polite"></div>
    </form>
  </div>

  <div id="eligModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-labelledby="eligTitle">
      <h3 id="eligTitle">Input error</h3>
      <p id="eligMsg"></p>
      <div style="text-align:right"><button id="eligClose">OK</button></div>
    </div>
  </div>

  <!-- single compact script: handles validation, multi-other, and submission -->
  <script>
  (function(){
    // --- Element refs ---
    const careerForm = document.getElementById('careerForm');
    const predictBtn = document.getElementById('predictBtn');
    const resultEl = document.getElementById('result');
    const eligModal = document.getElementById('eligModal');
    const eligMsg = document.getElementById('eligMsg');
    const eligClose = document.getElementById('eligClose');

    const percentIds = ['os','algo','prog','se','net','elec','arch','math','comm'];

    function showModal(msg){ eligMsg.textContent = msg; eligModal.style.display='flex'; eligModal.setAttribute('aria-hidden','false'); }
    function hideModal(){ eligModal.style.display='none'; eligModal.setAttribute('aria-hidden','true'); }
    eligClose.addEventListener('click', hideModal);
    eligModal.addEventListener('click', (ev)=>{ if(ev.target===eligModal) hideModal(); });

    // clamp percent inputs to [0,100]
    percentIds.forEach(id=>{
      const el = document.getElementById(id);
      if(!el) return;
      el.addEventListener('input', ()=>{
        const v = Number(el.value);
        if(!isFinite(v)) return;
        if(v>100) { el.value = 100; showModal('Value must be â‰¤ 100%'); }
        if(v<0) { el.value = 0; }
      });
    });

    // hackathon limit
    const hackEl = document.getElementById('hack');
    if(hackEl){
      hackEl.addEventListener('input', ()=>{
        const v = Number(hackEl.value || 0);
        if(!isFinite(v)) return;
        if(v>9){ hackEl.value = 9; showModal('Hackathons must be 0â€“9'); }
        if(v<0) hackEl.value = 0;
      });
    }

    // --- Multi-select "Other" handler (re-usable) ---
    (function setupMulti(){
      const selects = ['cert','work','career','company'];
      const multiRow = document.getElementById('multiCustomRow');
      const input = document.getElementById('multiCustomInput');
      const addBtn = document.getElementById('multiAddBtn');
      const cancelBtn = document.getElementById('multiCancelBtn');
      const hint = document.getElementById('multiHint');
      let activeSelect = null;

      function showFor(sel){ activeSelect = sel; sel.parentNode.insertBefore(multiRow, sel.nextSibling); multiRow.style.display='block'; multiRow.setAttribute('aria-hidden','false'); input.value=''; input.focus(); }
      function hide(){ if(multiRow.parentNode) multiRow.parentNode.removeChild(multiRow); multiRow.style.display='none'; activeSelect=null; }

      function onChange(e){
        const sel = e.target;
        const hasOther = Array.from(sel.selectedOptions).some(o=>o.value==='other');
        if(hasOther) showFor(sel); else if(activeSelect===sel) hide();
      }

      selects.forEach(id=>{ const el = document.getElementById(id); if(!el) return; el.addEventListener('change', onChange); });

      addBtn.addEventListener('click', ()=>{
        const text = (input.value||'').trim(); if(!text || !activeSelect) return;
        // dedupe by text
        const sel = activeSelect;
        const existing = Array.from(sel.options).find(o=>o.textContent.trim().toLowerCase()===text.toLowerCase());
        if(existing){ existing.selected = true; }
        else{
          const opt = document.createElement('option'); opt.value = 'custom-'+Date.now(); opt.textContent = text; opt.selected = true;
          if(sel.options.length>0) sel.insertBefore(opt, sel.options[0]); else sel.add(opt);
        }
        // deselect 'other'
        Array.from(sel.options).forEach(o=>{ if(o.value==='other') o.selected=false; });
        sel.dispatchEvent(new Event('change', {bubbles:true}));
        hide();
      });

      cancelBtn.addEventListener('click', ()=>{ if(!activeSelect) return; Array.from(activeSelect.options).forEach(o=>{ if(o.value==='other') o.selected=false; }); activeSelect.dispatchEvent(new Event('change',{bubbles:true})); hide(); });

      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); addBtn.click(); } else if(e.key==='Escape'){ e.preventDefault(); cancelBtn.click(); } });

    })();

    // --- form submit handler (single source of truth) ---
careerForm.addEventListener('submit', async function(e){
  e.preventDefault(); // prevent refresh
  resultEl.textContent = '';

  const percentIds = ['os','algo','prog','se','net','elec','arch','math','comm'];

 // SIMPLE ELIGIBILITY CHECK â€” SHOW ONLY ONE POPUP
// SIMPLE ELIGIBILITY CHECK â€” SHOW ONLY ONE POPUP
let eligible = true;

percentIds.forEach(id => {
  const raw = document.getElementById(id).value.trim();
  const v = Number(raw);

  // Allow empty (JS will catch later) BUT validate correctly
  if (!raw || !isFinite(v)) return;

  if (v < 35) eligible = false;
});

if (!eligible) {
  showModal("You cannot continue because one or more marks are below 35%. Please correct them and try again.");
  return;
}


  // FIXED: Multi-select â†’ count of selected items (integer)
  const certCount = document.getElementById('cert').selectedOptions.length;
  const workCount = document.getElementById('work').selectedOptions.length;
  const readCount = document.getElementById('read') ? document.getElementById('read').selectedOptions.length : 0;
  const careerCount = document.getElementById('career').selectedOptions.length;
  const companyCount = document.getElementById('company').selectedOptions.length;

  // Build clean numerical payload
  const payload = {
    "Acedamic percentage in Operating Systems": Number(document.getElementById('os').value || 0),
    "percentage in Algorithms": Number(document.getElementById('algo').value || 0),
    "Percentage in Programming Concepts": Number(document.getElementById('prog').value || 0),
    "Percentage in Software Engineering": Number(document.getElementById('se').value || 0),
    "Percentage in Computer Networks": Number(document.getElementById('net').value || 0),
    "Percentage in Electronics Subjects": Number(document.getElementById('elec').value || 0),
    "Percentage in Computer Architecture": Number(document.getElementById('arch').value || 0),
    "Percentage in Mathematics": Number(document.getElementById('math').value || 0),
    "Percentage in Communication skills": Number(document.getElementById('comm').value || 0),

    "Logical quotient rating": Number(document.getElementById('logic').value || 0),
    "hackathons": Number(document.getElementById('hack').value || 0),
    "coding skills rating": Number(document.getElementById('code').value || 0),
    "public speaking points": Number(document.getElementById('speak').value || 0),

    "self-learning capability?": Number(document.getElementById('self').value || 0),
    "Extra-courses did": Number(document.getElementById('extra').value || 0),

    // FIXED: converted lists â†’ numeric counts
    "certifications": certCount,
    "workshops": workCount,
    "reading and writing skills": readCount,
    "interested career area": careerCount,
    "Type of company want to settle in?": companyCount,

    "worked in teams ever?": Number(document.getElementById('team').value || 0)
  };

  // UI feedback
  predictBtn.disabled = true;
  predictBtn.textContent = 'Predicting...';
  resultEl.textContent = 'Predicting...';

  // Send request
  try{
    const res = await fetch('/predict', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const json = await res.json();

if(!res.ok){
  resultEl.textContent = 'Server error: ' + (json.error || res.status);
} else {
  if(json.predicted_job_role){
    // ðŸ”¥ FIXED â€” NO CONFIDENCE SHOWN
    resultEl.innerHTML = `ðŸŽ¯ Predicted Career Role: <b>${json.predicted_job_role}</b>`;
  } else if(json.error){
    resultEl.innerHTML = 'âš  Error: ' + json.error;
  } else {
    resultEl.innerHTML = 'âš  Unexpected server response.';
  }
}

  } catch(err){
    console.error(err);
    resultEl.textContent = 'âš  Cannot connect to backend.';
  } finally {
    predictBtn.disabled = false;
    predictBtn.textContent = 'Predict Career';
  }
});

    // set range outputs
    document.getElementById('logicOutput').value = document.getElementById('logic').value;
    document.getElementById('codeOutput').value = document.getElementById('code').value;
    document.getElementById('speakOutput').value = document.getElementById('speak').value;

  })();
  </script>
<script src="{{ url_for('static', filename='js/chip_select.js') }}"></script>

</body>
</html>
