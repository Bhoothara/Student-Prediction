<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
<meta name="theme-color" content="#007cf0">

<link rel="stylesheet" href="{{ url_for('static', filename='css/chip_select') }}">

  <link rel="stylesheet" href="{{ url_for('static', filename='career_form.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/predict_popup.css') }}">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Career Form ‚Äî Student Career Predictor</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f2f5; display:flex; justify-content:center; padding:40px; margin:0; }
    .page { width:100%; max-width:900px; }
    form.card { background:#fff; padding:25px; border-radius:10px; box-shadow:0 8px 24px rgba(0,0,0,0.06); }
    label { display:block; margin-top:12px; font-weight:600; color:#222; }
    input[type="number"], input[type="text"], select, output { width:100%; padding:9px; margin-top:6px; border:1px solid #ddd; border-radius:6px; font-size:14px; }
    .ranges { display:flex; gap:10px; align-items:center; }
    .ranges output { width:44px; text-align:center; background:#fafafa; border-radius:6px; padding:6px; border:1px solid #eee; }
    button { margin-top:18px; width:100%; padding:12px; background:#007bff; color:white; border:none; border-radius:8px; cursor:pointer; font-size:16px; }
    button:disabled { background:#9bbcf0; cursor:not-allowed; }
    #result { margin-top:18px; font-weight:700; font-size:16px; text-align:center; min-height:28px; }
    .modal-backdrop { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.45); z-index:2000; padding:20px; }
    .modal { width:420px; max-width:94%; background:#fff; border-radius:10px; padding:20px; box-shadow:0 12px 40px rgba(0,0,0,0.3); text-align:center; }
    .modal h3 { margin:0 0 10px; }
    .modal p { margin:0 0 14px; }
    .modal button { width:auto; padding:10px 14px; border-radius:8px; background:#23272b; color:#fff; border:none; cursor:pointer; }
  </style>
</head>
<body>
  <!-- Responsive Top Navigation Bar -->
  <nav style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(to right, #007cf0, #00dfd8);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 30px;
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    box-sizing: border-box;
  ">
    <div style="display: flex; align-items: center; gap: 10px;">
      <span style="font-size: 1.6rem;">üéì</span>
      <h2 style="margin: 0; font-weight: 700; font-size: 1.4rem;">Welcome to Student Career Predictor</h2>
    </div>

    {% if user %}
      <div style="display: flex; align-items: center; gap: 15px; flex-shrink: 0;">
        <span style="font-size: 0.95rem;">Welcome, <b>{{ user.username }}</b></span>
        <a href="{{ url_for('logout') }}" 
           style="
             background-color: white;
             color: #007cf0;
             padding: 8px 16px;
             border-radius: 20px;
             text-decoration: none;
             font-weight: 600;
             font-size: 0.95rem;
             transition: 0.3s;
             white-space: nowrap;
           "
           onmouseover="this.style.backgroundColor='#e3f2ff'"
           onmouseout="this.style.backgroundColor='white'">
          Logout
        </a>
      </div>
    {% endif %}
  </nav>

  <!-- Spacer to prevent overlap -->
  <div style="margin-top: 80px;"></div>

  <script src="{{ url_for('static', filename='js/predict_popup.js') }}"></script>
  <div class="page">
    <form id="careerForm" class="card" autocomplete="off">
      <h2>üéì Career Prediction Form</h2>

      <label>Acedamic % in Operating Systems</label>
      <input type="number" id="os" min="0" max="100" required>

      <label>Percentage in Algorithms</label>
      <input type="number" id="algo" min="0" max="100" required>

      <label>Programming Concepts (%)</label>
      <input type="number" id="prog" min="0" max="100" required>

      <label>Software Engineering (%)</label>
      <input type="number" id="se" min="0" max="100" required>

      <label>Computer Networks (%)</label>
      <input type="number" id="net" min="0" max="100" required>

      <label>Electronics Subjects (%)</label>
      <input type="number" id="elec" min="0" max="100" required>

      <label>Computer Architecture (%)</label>
      <input type="number" id="arch" min="0" max="100" required>

      <label>Mathematics (%)</label>
      <input type="number" id="math" min="0" max="100" required>

      <label>Communication Skills (%)</label>
      <input type="number" id="comm" min="0" max="100" required>

      <label>Logical Quotient Rating (1‚Äì10)</label>
      <div class="ranges">
        <input type="range" id="logic" min="1" max="10" value="5" oninput="logicOutput.value=this.value">
        <output id="logicOutput">5</output>
      </div>

      <label>Hackathons Attended</label>
      <input type="number" id="hack" min="0" max="20" required>

      <label>Coding Skills Rating (1‚Äì10)</label>
      <div class="ranges">
        <input type="range" id="code" min="1" max="10" value="5" oninput="codeOutput.value=this.value">
        <output id="codeOutput">5</output>
      </div>

      <label>Public Speaking Points (1‚Äì10)</label>
      <div class="ranges">
        <input type="range" id="speak" min="1" max="10" value="5" oninput="speakOutput.value=this.value">
        <output id="speakOutput">5</output>
      </div>

      <label>Self-Learning Capability?</label>
      <select id="self">
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>

      <label>Extra Courses Done?</label>
      <select id="extra">
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>

<label>Certifications</label>
<select id="cert" multiple class="chip-enabled">
  <option value="">-- Select Certification --</option>
  <option value="1">Python Programming</option>
  <option value="2">Java Full Stack</option>
  <option value="3">Data Science</option>
  <option value="4">Machine Learning</option>
  <option value="5">Cloud Computing (AWS / Azure)</option>
  <option value="6">Cyber Security</option>
  <option value="7">Web Development</option>
  <option value="8">Database Management (SQL)</option>
  <option value="9">Artificial Intelligence</option>
  <option value="10">Other</option>
</select>


<label>Workshops</label>
<select id="work" required>
  <option value="">-- Select Workshop --</option>
  <option value="1">Python Programming Workshop</option>
  <option value="2">AI & Machine Learning Bootcamp</option>
  <option value="3">Web Development Workshop</option>
  <option value="4">Data Analytics with Excel</option>
  <option value="5">Cyber Security Awareness Workshop</option>
  <option value="6">Cloud Computing (AWS / Azure)</option>
  <option value="7">Database & SQL Workshop</option>
  <option value="8">Mobile App Development Workshop</option>
  <option value="9">IoT (Internet of Things)</option>
  <option value="10">Other</option>
</select>


 <label>Reading/Writing Skills</label>
<select id="read" required>
  <option value="">-- Select Reading/Writing Level --</option>
  <option value="1">Excellent ‚Äî Strong reading & writing communication</option>
  <option value="2">Good ‚Äî Can write and understand technical content</option>
  <option value="3">Average ‚Äî Understands basics but needs improvement</option>
  <option value="4">Below Average ‚Äî Struggles with comprehension</option>
  <option value="5">Poor ‚Äî Needs major improvement</option>
</select>

<label>Interested Career Area</label>
<select id="career" required>
  <option value="">-- Select Your Career Interest --</option>
  <option value="1">Software Development</option>
  <option value="2">Web Development</option>
  <option value="3">Data Science / Machine Learning</option>
  <option value="4">Artificial Intelligence</option>
  <option value="5">Cybersecurity</option>
  <option value="6">Cloud Computing</option>
  <option value="7">Networking & Infrastructure</option>
  <option value="8">Database Administration</option>
  <option value="9">UI/UX Design</option>
  <option value="10">Research & Teaching</option>
</select>
<label>Preferred Company Type</label>
<select id="company" required>
  <option value="">-- Select Preferred Company Type --</option>
  <option value="1">Startup</option>
  <option value="2">Product-Based Company</option>
  <option value="3">Service-Based Company</option>
  <option value="4">Government Organization</option>
  <option value="5">Research Institute</option>
  <option value="6">Non-Profit / NGO</option>
  <option value="7">Freelance / Self-Employed</option>
  <option value="8">Abroad / MNC Company</option>
</select>


      <label>Worked in Teams Before?</label>
      <select id="team">
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>

      <button id="predictBtn" type="submit">Predict Career</button>
      <div id="result"></div>
    </form>
  </div>

  <!-- Eligibility Modal -->
  <div id="eligModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-labelledby="eligTitle">
      <h3 id="eligTitle">Not eligible</h3>
      <p id="eligMsg"></p>
      <button id="eligClose">OK</button>
    </div>
  </div>

  <script>
    const requiredPercentIds = ['os','algo','prog','se','net','elec','arch','math','comm'];
    const predictBtn = document.getElementById('predictBtn');
    const eligibilityModal = document.getElementById('eligModal');
    const eligClose = document.getElementById('eligClose');
    const eligMsg = document.getElementById('eligMsg');
    const careerForm = document.getElementById('careerForm');

    function rawVal(id) { return document.getElementById(id).value.trim(); }
    function numVal(id) { const v = rawVal(id); return v === "" ? NaN : Number(v); }

    function showIneligibleModal(badFields) {
      const parts = badFields.map(f => {
        const v = rawVal(f) || "empty";
        const labelMap = { os:"OS", algo:"Algorithms", prog:"Programming Concepts", se:"Software Engineering", net:"Computer Networks", elec:"Electronics", arch:"Computer Architecture", math:"Mathematics", comm:"Communication Skills" };
        return `${labelMap[f] || f}: ${v}%`;
      });
      eligMsg.textContent = `The following field(s) are below the minimum required (35%): ${parts.join(', ')}. Please correct them to continue.`;
      eligibilityModal.style.display = 'flex';
      eligibilityModal.setAttribute('aria-hidden','false');
    }

    function closeEligibilityModal() { eligibilityModal.style.display = 'none'; eligibilityModal.setAttribute('aria-hidden','true'); }

    eligClose.addEventListener('click', closeEligibilityModal);
    eligibilityModal.addEventListener('click', (ev) => { if (ev.target === eligibilityModal) closeEligibilityModal(); });

    requiredPercentIds.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('blur', () => {
        const raw = rawVal(id);
        if (raw === "") return;
        const nv = Number(raw);
        if (!isFinite(nv)) return;
        if (nv < 35) {
          showIneligibleModal([id]);
        }
      });
    });
    careerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const bad = [];
      for (let i = 0; i < requiredPercentIds.length; i++) {
        const id = requiredPercentIds[i];
        const raw = rawVal(id);
        if (raw === "") { bad.push(id); continue; }
        const nv = Number(raw);
        if (!isFinite(nv) || nv < 35) { bad.push(id); }
      }

      if (bad.length > 0) { showIneligibleModal(bad); return; }

      predictBtn.disabled = true;
      const payload = {
        "Acedamic percentage in Operating Systems": numVal('os') || 0,
        "percentage in Algorithms": numVal('algo') || 0,
        "Percentage in Programming Concepts": numVal('prog') || 0,
        "Percentage in Software Engineering": numVal('se') || 0,
        "Percentage in Computer Networks": numVal('net') || 0,
        "Percentage in Electronics Subjects": numVal('elec') || 0,
        "Percentage in Computer Architecture": numVal('arch') || 0,
        "Percentage in Mathematics": numVal('math') || 0,
        "Percentage in Communication skills": numVal('comm') || 0,
        "Logical quotient rating": Number(document.getElementById('logic').value || 0),
        "hackathons": Number(document.getElementById('hack').value || 0),
        "coding skills rating": Number(document.getElementById('code').value || 0),
        "public speaking points": Number(document.getElementById('speak').value || 0),
        "self-learning capability?": Number(document.getElementById('self').value || 0),
        "Extra-courses did": Number(document.getElementById('extra').value || 0),
        "certifications": Number(document.getElementById('cert').value || 0),
        "workshops": Number(document.getElementById('work').value || 0),
        "reading and writing skills": Number(document.getElementById('read').value || 0),
        "interested career area": Number(document.getElementById('career').value || 0),
        "Type of company want to settle in?": Number(document.getElementById('company').value || 0),
        "worked in teams ever?": Number(document.getElementById('team').value || 0)
      };

      const resultEl = document.getElementById('result');
      resultEl.textContent = "Predicting...";

      try {
        const res = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const json = await res.json();
        if (json && json.predicted_job_role) {
          resultEl.innerHTML = `üéØ Predicted Career Role: <b>${json.predicted_job_role}</b>`;
        } else {
          resultEl.innerHTML = `‚ö†Ô∏è Error: ${json.error || "Unexpected server response."}`;
        }
      } catch (err) {
        resultEl.innerHTML = "‚ö†Ô∏è Cannot connect to backend. Make sure Flask server is running.";
      } finally {
        predictBtn.disabled = false;
      }
    });

    document.getElementById('logicOutput').value = document.getElementById('logic').value;
    document.getElementById('codeOutput').value = document.getElementById('code').value;
    document.getElementById('speakOutput').value = document.getElementById('speak').value;
    
  </script>
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/static/sw.js')
        .then(reg => console.log('Service Worker registered:', reg.scope))
        .catch(err => console.log('SW registration failed:', err));
    });
  }
</script>


  
  <script src="{{ url_for('static', filename='js/chip_select.js') }}"></script>

  <script src="{{ url_for('static', filename='js/predict_popup.js') }}"></script>
</body>
</html>
